<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Budget</title>
    <link href="assests/bootstrap-5.3.2-dist/css/bootstrap.css" rel="stylesheet" />
    <link rel="stylesheet" href="assests/bootstrap-5.3.2-dist/css/budget.css" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/brands.min.css">

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Graduate&display=swap" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">
</head>

<body>
  <div class="header">
        <!-- Your header content goes here -->
        <img src="assests/images/budget-img.jpg" alt="Contact Header Image">
    </div>

    <div class="Budget-section">
        <div class="container">
            <div class="tag">
                <p class="contact">Travel Treasury</p>
                <p> </p>
            </div>

    <form id="userInputForm">
      <div id="group">
        <label for="groupName">Enter Group Name:</label><br>
        <img id="groupicon" src="assests/images/groupicon.png" alt="icon">
        <input type="text" id="groupName" required><br>
      </div>
    
        <label for="count">Enter Count:</label>
        <input type="number" id="count" required><br>
    
        <div id="memberInputs"></div>
      </form>
    
      <button id="calculateTotalBtn">Click</button>
    
    
    
      <table id="expenseTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Amount Paid</th>
            <th>Total Spent</th>
          </tr>
        </thead>
        <tbody id="expenseTableBody"></tbody>
      </table>
    
      <button id="submitBtn">Submit</button>
        </div>
      <script>
        document.getElementById('count').addEventListener('input', function () {
          const count = parseInt(this.value);
          const memberInputs = document.getElementById('memberInputs');
    
          let inputsHTML = '';
          for (let i = 0; i < count; i++) {
            inputsHTML += `
              <label for="name${i}">Enter Name:</label>
              <input name="name" type="text" id="name${i}" required>`;
          }
    
          memberInputs.innerHTML = inputsHTML;
        });
    
    
    
        document.getElementById('calculateTotalBtn').addEventListener('click', function () {
          const group = document.getElementById('groupName').value.trim();
          const count = parseInt(document.getElementById('count').value);
          const userData = [];
    
          for (let i = 0; i < count; i++) {
            const name = document.getElementById(`name${i}`).value;
            userData.push({ name });
          }
    
          fetch('/saveData', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ group, userData }), // Issue might be here
          })
            .then(response => response.json())
            .then(data => {
              console.log(data);
              alert(data)
            })
            .catch(error => {
              console.error('Error:', error);
            });
    
          const expenseTableBody = document.getElementById('expenseTableBody');
          expenseTableBody.innerHTML = '';
          userData.forEach(({ name }) => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${name}</td>
              <td>
                <input type="number" class="amountPaid">
                </td>
                <td><button class="addButton">Add</button>
              </td>
              <td class="totalSpent">0</td>
            `;
            expenseTableBody.appendChild(row);
          });
        });
    
    
    
    
    
    
        document.getElementById('expenseTable').addEventListener('click', function (event) {
          if (event.target.classList.contains('amountPaid')) {
            const row = event.target.closest('tr');
            const amountPaid = parseFloat(event.target.value || 0);
            const totalSpentCell = row.querySelector('.totalSpent');
            let totalSpent = parseFloat(totalSpentCell.textContent || 0);
            totalSpent += amountPaid;
            totalSpentCell.textContent = totalSpent.toFixed(2); // Format to two decimal places
          }
        });
    
    
        document.getElementById('expenseTable').addEventListener('click', function (event) {
          if (event.target.classList.contains('addButton')) {
            const row = event.target.closest('tr');
            const amountInput = row.querySelector('.amountPaid');
            const amountPaid = parseFloat(amountInput.value || 0);
            const totalSpentCell = row.querySelector('.totalSpent');
            let totalSpent = parseFloat(totalSpentCell.textContent || 0);
            totalSpent += amountPaid;
            totalSpentCell.textContent = totalSpent.toFixed(2); // Format to two decimal places
            amountInput.value = ''; // Clear the input field
          }
        });
    
        document.getElementById('submitBtn').addEventListener('click', function () {
          const data = [];
          const rows = document.querySelectorAll('#expenseTable tbody tr');
          rows.forEach(row => {
            const name = row.cells[0].textContent;
            const totalSpent = parseFloat(row.cells[2].textContent);
            data.push({ name, totalSpent });
          });
    
          fetch('/updateCollection', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ group,data }),
          })
          .then(response => response.text())
          .then(data => {
            alert(data);
          })
          .catch(error => {
            console.error('Error:', error);
            alert('Error updating collection. Please try again.');
          });
        });
    
    
      </script>

    
</body>

</html>